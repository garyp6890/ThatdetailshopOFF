{%-  liquid  
     assign NS = 'sticky-add-to-cart'
     assign cn = '#' | append: NS

     assign ns_od = 'product-options-dropdown'
     assign cn_od = '#' | append: ns_od

     assign dropdown_position = 'top-center'
     if position == 'top'
        assign dropdown_position = 'bottom-center'
     endif
-%}

{% render 'load-css', file: NS %}
{% render 'load-css', file: 'product-options-dropdown' %}

{%- capture Button_atts -%}form="{{ product_form_id }}" data-element="to-cart-button"{%- endcapture -%}
    <{{ NS }} class="{{ cn }} @position:{{ position }}" section-id="{{ section.id }}" {% if position == 'bottom' %}sticky-bottom{% endif %}>
        <div data-element="observer-trigger"></div>
        <product-variant-listener section-id="{{ section.id }}" id="sticky-add-to-cart" variant-selector>

            <div class="{{ cn }}-wrapper" data-element="wrapper">
                <div class="{{ cn }}-loading-overlay">
                    {% render 'spinner', size: 'sm' %}
                </div>
                <div class="#container">    
                    <div class="{{ cn }}-inner">
                        <div class="{{ cn }}-info mobile-hidden">
                            <a class="stretched-link" href="#productPageContainer-{{ section.id }}" aria-label="{{ product.title }}"></a>
                            <div class="{{ cn }}-info-media">
                                {%- assign image = current_variant.featured_image | default: product.featured_image -%}
                                {% render 'media', 
                                    image: image, 
                                    image_res: 60,
                                    image_fit: 'contain',
                                    aspect_ratio: '1x1',
                                    border-radius: 'inner',
                                    placeholder: 'product',
                                    placeholder_index: placeholder_index,
                                %}
                            </div>
                            <div>
                                <h3 class="{{ cn }}-info-title">{{ product.title }}</h3>
                                {%- unless product.has_only_default_variant -%}
                                    <p class="{{ cn }}-info-variant">
                                        {%- for product_option in product.options_with_values -%}
                                            {% assign selected_value = product_option.values | find: 'selected', true %}
                                            <span class="{{ cn }}-info-variant-title">{{ product_option.name }}: {{ selected_value.name }}</span>
                                        {%- endfor -%}
                                    </p>
                                {%- endunless -%}
                            </div>
                        </div>

                        <div class="{{ cn }}-control">    
                            {%- capture Button_label -%}
                                {%- assign button_label = 'products.product.add_to_cart' | t  -%}
                                <span>{{ button_label }}</span>
                                <span class="{{ cn }}-control-button-price desktop-hidden">{{ current_variant.price | money }}</span>
                            {%- endcapture -%}

                            <div class="{{ cn }}-control-price">
                                {% render 'price',
                                    variant: current_variant
                                %}
                            </div>
                            
                            <div class="{{ cn }}-control-button">
                                {% if current_variant.available %}
                                    {%- capture Add_to_cart -%}
                                        {% render 'button',
                                            type: 'submit',
                                            size: 'h5',
                                            text: Button_label,
                                            loading: true,
                                            atts: Button_atts,
                                            no_arrow: true
                                        %}
                                    {%- endcapture -%}
                                    {% render 'product-to-cart', 
                                        trigger: Add_to_cart,
                                        form_child: true
                                    %}
                                {% else %}
                                    {%- assign disabled_button_t_label = 'products.product.sold_out' -%}
                                    {% render 'button',
                                        t_text: disabled_button_t_label,
                                        atts: 'disabled',
                                        no_arrow: true
                                    %}
                                {% endif %}
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </product-variant-listener>  
    </{{ NS }}>
<script type="module" src="{{ NS | append: '.js' | asset_url }}"></script>